# Kubernetes에서 MinIO 분산 배포 - 완전 가이드

## 📋 목차
1. [개요](#개요)
2. [아키텍처](#아키텍처)
3. [사전 요구사항](#사전-요구사항)
4. [단계별 배포 과정](#단계별-배포-과정)
5. [문제 해결](#문제-해결)
6. [관리 및 운영](#관리-및-운영)
7. [보안 고려사항](#보안-고려사항)

## 🎯 개요

이 가이드는 Kubernetes 클러스터에서 MinIO를 분산 모드로 배포하는 포괄적인 안내서를 제공합니다. MinIO는 여러 노드에 걸쳐 배포하여 중복성과 확장성을 제공할 수 있는 고성능 S3 호환 객체 스토리지 시스템입니다.

### 이 배포가 제공하는 것:
- **분산 객체 스토리지** - 모든 클러스터 노드에 걸쳐
- **고가용성** - 자동 장애 조치 기능
- **S3 호환 API** - 애플리케이션 통합을 위한
- **웹 기반 관리 콘솔**
- **로컬 스토리지 활용** - 최대 성능을 위한
- **수평 확장성** - 클러스터 성장에 따른

### 배포 모드:
- **단일 노드**: 독립형 MinIO 인스턴스 (1개 복제본)
- **2-노드**: 제한된 중복성을 가진 기본 분산 설정
- **다중 노드**: 삭제 코딩을 사용한 완전 분산 모드 (4개 이상 복제본)

## 🏗️ 아키텍처

### 고수준 아키텍처 다이어그램
```
┌─────────────────────────────────────────────────────────────┐
│                    Kubernetes 클러스터                       │
├─────────────────┬─────────────────┬─────────────────────────┤
│   노드 1        │   노드 2        │   노드 N                │
│                 │                 │                         │
│ ┌─────────────┐ │ ┌─────────────┐ │ ┌─────────────────────┐ │
│ │   minio-0   │ │ │   minio-1   │ │ │     minio-N         │ │
│ │             │ │ │             │ │ │                     │ │
│ │ 포트: 9000  │ │ │ 포트: 9000  │ │ │   포트: 9000        │ │
│ │ 포트: 9001  │ │ │ 포트: 9001  │ │ │   포트: 9001        │ │
│ └─────────────┘ │ └─────────────┘ │ └─────────────────────┘ │
│        │        │        │        │            │            │
│ ┌─────────────┐ │ ┌─────────────┐ │ ┌─────────────────────┐ │
│ │로컬 스토리지│ │ │로컬 스토리지│ │ │   로컬 스토리지     │ │
│ │/mnt/minio-  │ │ │/mnt/minio-  │ │ │  /mnt/minio-data    │ │
│ │data (10Gi)  │ │ │data (10Gi)  │ │ │     (10Gi)          │ │
│ └─────────────┘ │ └─────────────┘ │ └─────────────────────┘ │
└─────────────────┴─────────────────┴─────────────────────────┘
                           │
                    ┌─────────────┐
                    │   외부      │
                    │   접근      │
                    │             │
                    │ API: 30900  │
                    │콘솔: 30901  │
                    └─────────────┘
```

### 컴포넌트 아키텍처

#### 1. **StatefulSet**
- **목적**: 안정적인 네트워크 식별자를 가진 MinIO 파드 관리
- **복제본**: 클러스터 크기에 따라 자동 결정
- **명명**: 파드는 `minio-0`, `minio-1` 등으로 명명
- **순서**: 파드는 순서대로 생성 및 삭제

#### 2. **영구 볼륨 (PV)**
- **유형**: 각 노드의 로컬 스토리지
- **경로**: 각 노드의 `/mnt/minio-data`
- **크기**: 노드당 10Gi (구성 가능)
- **바인딩**: 각 PV는 노드 친화성을 사용하여 특정 노드에 바인딩

#### 3. **서비스**
- **헤드리스 서비스**: 클러스터 내 파드 간 통신 활성화
- **API 서비스**: S3 API 접근을 위한 NodePort (30900)
- **콘솔 서비스**: 웹 UI 접근을 위한 NodePort (30901)

#### 4. **스토리지 클래스**
- **프로비저너**: `kubernetes.io/no-provisioner` (로컬 스토리지)
- **바인딩 모드**: `WaitForFirstConsumer` (파드가 스케줄될 때 바인딩)
- **회수 정책**: `Retain` (PV 삭제 후에도 데이터 유지)

## 📋 사전 요구사항

### Kubernetes 클러스터 요구사항:
- **Kubernetes 버전**: 1.19+ 권장
- **노드 수**: 1-N개 노드 (분산 모드를 위해 2개 이상 권장)
- **노드 리소스**: 노드당 최소 2GB RAM, 2 CPU 코어
- **스토리지**: 노드당 최소 10GB 여유 공간
- **네트워크**: 파드 간 통신 활성화

### 필요한 도구:
- 클러스터에 접근하도록 구성된 `kubectl`
- Bash 셸 (Linux/macOS/WSL)
- 클러스터 관리자 권한

### 네트워크 요구사항:
- **내부 통신**: 파드는 9000 포트에서 통신해야 함
- **외부 접근**: 30900 (API) 및 30901 (콘솔) NodePort 서비스
- **DNS 해결**: 클러스터 DNS가 작동해야 함

### 스토리지 요구사항:
- **로컬 디스크 공간**: 노드당 10GB 이상
- **파일 시스템**: POSIX 호환 파일 시스템
- **권한**: 디렉토리 생성 및 소유권 설정 능력

## 🔧 배포 전 체크리스트

배포 스크립트를 실행하기 전에 확인:

```bash
# 1. 클러스터 연결 확인
kubectl cluster-info

# 2. 노드 상태 확인
kubectl get nodes -o wide

# 3. 노드의 사용 가능한 스토리지 확인
kubectl describe nodes | grep -A 5 "Capacity:"

# 4. 기존 MinIO 배포가 없는지 확인
kubectl get namespace minio-system

# 5. 기존 MinIO PV가 있는지 확인
kubectl get pv | grep minio
```

### 노드 준비 명령어:
```bash
# 각 노드의 디스크 공간 확인
df -h /

# 사용자 권한 확인 (필요한 경우)
sudo mkdir -p /mnt/minio-data
sudo chown 1000:1000 /mnt/minio-data
```

## 🚀 빠른 시작

즉시 배포를 위해:

```bash
# 1. 스크립트 복제 또는 다운로드
chmod +x deploy-minio-distributed.sh

# 2. 배포 실행
./deploy-minio-distributed.sh

# 3. 배포 모니터링
kubectl get pods -n minio-system -w

# 4. MinIO 콘솔 접근
# 브라우저에서 http://<node-ip>:30901 열기
# 로그인: minioadmin / minioadmin123
```

---

*다음 섹션의 자세한 단계별 배포 과정을 계속 참조하세요...*
